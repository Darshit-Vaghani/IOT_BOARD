<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Distribution Board Monitoring</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <style>
        :root {
            --primary: #3498db;
            --secondary: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
            --dark: #2c3e50;
            --light: #ecf0f1;
            --gray: #95a5a6;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background-color: #f5f7fa;
            color: #333;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--dark), #34495e);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .card-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--dark);
        }
        
        .card-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--light);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
        }
        
        .meter-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .meter {
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            background-color: #f8f9fa;
        }
        
        .meter-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 5px 0;
        }
        
        .meter-label {
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .meter-unit {
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        .main-circuit {
            border-left: 4px solid var(--primary);
        }
        
        .sub-circuit {
            border-left: 4px solid var(--secondary);
        }
        
        .solar-circuit {
            border-left: 4px solid var(--warning);
        }
        
        .main-phase {
            border-left: 4px solid var(--danger);
        }
        
        .chart-container {
            height: 250px;
            margin-top: 15px;
        }
        
        .status-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
        }
        
        .status-item {
            flex: 1;
            min-width: 120px;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            background-color: #f8f9fa;
        }
        
        .status-value {
            font-size: 1.2rem;
            font-weight: 600;
            margin: 5px 0;
        }
        
        .status-active {
            color: var(--secondary);
        }
        
        .status-inactive {
            color: var(--danger);
        }
        
        .status-label {
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .map-container {
            height: 250px;
            border-radius: 8px;
            overflow: hidden;
            margin-top: 15px;
        }
        
        .control-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: var(--secondary);
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        .control-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            border-radius: 8px;
            background-color: #f8f9fa;
        }
        
        .control-label {
            font-weight: 500;
        }
        
        .seal-status {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100px;
            margin-top: 15px;
            border-radius: 8px;
            font-size: 1.5rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .seal-intact {
            background-color: rgba(46, 204, 113, 0.1);
            color: var(--secondary);
            border: 2px solid var(--secondary);
        }
        
        .seal-tampered {
            background-color: rgba(231, 76, 60, 0.1);
            color: var(--danger);
            border: 2px solid var(--danger);
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.6; }
            100% { opacity: 1; }
        }
        
        .section-title {
            font-size: 1.5rem;
            margin: 30px 0 15px;
            color: var(--dark);
            padding-bottom: 8px;
            border-bottom: 2px solid var(--primary);
        }
        
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .meter-grid {
                grid-template-columns: 1fr;
            }
            
            .control-panel {
                grid-template-columns: 1fr;
            }
        }
        .dashboardd {
            display: flex;
            flex-direction: column;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Smart Distribution Board Monitoring</h1>
            <p class="subtitle">Real-time monitoring and control of your power distribution system</p>
        </header>
        
        <!-- Real-time Meter Readings -->
        <h2 class="section-title">Real-time Measurements</h2>
        <div class="dashboard">
            <div class="card main-circuit">
                <div class="card-header">
                    <div class="card-title">Main Circuit</div>
                    <div class="card-icon">M</div>
                </div>
                <div class="meter-grid">
                    <div class="meter">
                        <div class="meter-label">Voltage</div>
                        <div class="meter-value" id="main-voltage">230.5</div>
                        <div class="meter-unit">V</div>
                    </div>
                    <div class="meter">
                        <div class="meter-label">Current</div>
                        <div class="meter-value" id="main-current">15.2</div>
                        <div class="meter-unit">A</div>
                    </div>
                    <div class="meter">
                        <div class="meter-label">Power</div>
                        <div class="meter-value" id="main-power">3492</div>
                        <div class="meter-unit">W</div>
                    </div>
                    <div class="meter">
                        <div class="meter-label">Energy</div>
                        <div class="meter-value" id="main-energy">24.8</div>
                        <div class="meter-unit">kWh</div>
                    </div>
                    <div class="meter">
                        <div class="meter-label">Power Factor</div>
                        <div class="meter-value" id="main-pf">0.98</div>
                        <div class="meter-unit"></div>
                    </div>
                    <div class="meter">
                        <div class="meter-label">Frequency</div>
                        <div class="meter-value" id="main-freq">49.9</div>
                        <div class="meter-unit">Hz</div>
                    </div>
                </div>
            </div>
            
            <div class="card sub-circuit">
                <div class="card-header">
                    <div class="card-title">Sub Circuit</div>
                    <div class="card-icon">S</div>
                </div>
                <div class="meter-grid">
                    <div class="meter">
                        <div class="meter-label">Voltage</div>
                        <div class="meter-value" id="sub-voltage">229.8</div>
                        <div class="meter-unit">V</div>
                    </div>
                    <div class="meter">
                        <div class="meter-label">Current</div>
                        <div class="meter-value" id="sub-current">8.7</div>
                        <div class="meter-unit">A</div>
                    </div>
                    <div class="meter">
                        <div class="meter-label">Power</div>
                        <div class="meter-value" id="sub-power">1998</div>
                        <div class="meter-unit">W</div>
                    </div>
                    <div class="meter">
                        <div class="meter-label">Energy</div>
                        <div class="meter-value" id="sub-energy">12.3</div>
                        <div class="meter-unit">kWh</div>
                    </div>
                    <div class="meter">
                        <div class="meter-label">Power Factor</div>
                        <div class="meter-value" id="sub-pf">0.95</div>
                        <div class="meter-unit"></div>
                    </div>
                    <div class="meter">
                        <div class="meter-label">Frequency</div>
                        <div class="meter-value" id="sub-freq">49.9</div>
                        <div class="meter-unit">Hz</div>
                    </div>
                </div>
            </div>
            
            <div class="card solar-circuit">
                <div class="card-header">
                    <div class="card-title">Solar Input</div>
                    <div class="card-icon">☀️</div>
                </div>
                <div class="meter-grid">
                    <div class="meter">
                        <div class="meter-label">Voltage</div>
                        <div class="meter-value" id="solar-voltage">245.3</div>
                        <div class="meter-unit">V</div>
                    </div>
                    <div class="meter">
                        <div class="meter-label">Current</div>
                        <div class="meter-value" id="solar-current">12.1</div>
                        <div class="meter-unit">A</div>
                    </div>
                    <div class="meter">
                        <div class="meter-label">Power</div>
                        <div class="meter-value" id="solar-power">2968</div>
                        <div class="meter-unit">W</div>
                    </div>
                    <div class="meter">
                        <div class="meter-label">Energy Today</div>
                        <div class="meter-value" id="solar-energy">18.7</div>
                        <div class="meter-unit">kWh</div>
                    </div>
                    <div class="meter">
                        <div class="meter-label">Power Factor</div>
                        <div class="meter-value" id="solar-pf">1.0</div>
                        <div class="meter-unit"></div>
                    </div>
                    <div class="meter">
                        <div class="meter-label">Frequency</div>
                        <div class="meter-value" id="solar-freq">50.1</div>
                        <div class="meter-unit">Hz</div>
                    </div>
                </div>
            </div>
            
            <div class="card main-phase">
                <div class="card-header">
                    <div class="card-title">Main Phase Line</div>
                    <div class="card-icon">⚡</div>
                </div>
                <div class="meter-grid">
                    <div class="meter">
                        <div class="meter-label">Voltage</div>
                        <div class="meter-value" id="phase-voltage">231.2</div>
                        <div class="meter-unit">V</div>
                    </div>
                    <div class="meter">
                        <div class="meter-label">Current</div>
                        <div class="meter-value" id="phase-current">23.8</div>
                        <div class="meter-unit">A</div>
                    </div>
                    <div class="meter">
                        <div class="meter-label">Power</div>
                        <div class="meter-value" id="phase-power">5490</div>
                        <div class="meter-unit">W</div>
                    </div>
                    <div class="meter">
                        <div class="meter-label">Energy</div>
                        <div class="meter-value" id="phase-energy">37.1</div>
                        <div class="meter-unit">kWh</div>
                    </div>
                    <div class="meter">
                        <div class="meter-label">Power Factor</div>
                        <div class="meter-value" id="phase-pf">0.97</div>
                        <div class="meter-unit"></div>
                    </div>
                    <div class="meter">
                        <div class="meter-label">Frequency</div>
                        <div class="meter-value" id="phase-freq">49.9</div>
                        <div class="meter-unit">Hz</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- System Status -->
        <h2 class="section-title">System Status</h2>
        <div class="dashboard">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Seal Status</div>
                    <div class="card-icon">🔒</div>
                </div>
                <div class="seal-status seal-intact" id="seal-status">
                    SEAL INTACT
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Location</div>
                    <div class="card-icon">📍</div>
                </div>
                <div id="map" class="map-container"></div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Power Source</div>
                    <div class="card-icon">🔌</div>
                </div>
                <div class="status-container">
                    <div class="status-item">
                        <div class="status-label">Current Source</div>
                        <div class="status-value status-active" id="current-source">Main Phase</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">Solar Available</div>
                        <div class="status-value status-active">Yes</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Control Panel -->
        <h2 class="section-title">Control Panel</h2>
        <div class="card">
            <div class="card-header">
                <div class="card-title">Circuit Switching</div>
                <div class="card-icon">⚙️</div>
            </div>
            <div class="control-panel">
                <div class="control-item">
                    <div class="control-label">Power Source</div>
                    <label class="switch">
                        <input type="checkbox" id="source-switch">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="control-item">
                    <div class="control-label">Main Circuit</div>
                    <label class="switch">
                        <input type="checkbox" id="main-switch" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="control-item">
                    <div class="control-label">Sub Circuit</div>
                    <label class="switch">
                        <input type="checkbox" id="sub-switch" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="control-item">
                    <div class="control-label">Entire Board</div>
                    <label class="switch">
                        <input type="checkbox" id="entire-switch" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="control-item">
                    <div class="control-label">Seal reset</div>
                    <label class="switch">
                        <input type="checkbox" id="seal_reset">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
        </div>
        
        <!-- Data Analysis Charts -->
        <h2 class="section-title">Power Analysis</h2>
        <div class="dashboardd">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Power Consumption (Last 24h)</div>
                    <div class="card-icon">📊</div>
                </div>
                <div class="chart-container" id="power-chart"></div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Current Flow (Last 24h)</div>
                    <div class="card-icon">📈</div>
                </div>
                <div class="chart-container" id="current-chart"></div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Power Factor (Last 24h)</div>
                    <div class="card-icon">📉</div>
                </div>
                <div class="chart-container" id="pf-chart"></div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Daily Energy Consumption</div>
                    <div class="card-icon">📅</div>
                </div>
                <div class="chart-container" id="energy-chart"></div>
            </div>
        </div>
    </div>
    
    <script>
var trip_state = false;
        // JSON object to hold switch states
    const switchStates = {
        "Power_Source": false,
        "Main_Circuit": true,
        "Sub_Circuit": true,
        "Entire_Board": true,
        "reset_seal":false
    };

    // Function to handle switch changes
    function handleSwitchChange(event) {

       if(trip_state &&(!confirm("The Triping mode is ON so ensure you set your all setting"))) {
        console.log("OK i RETURN from function");
        return;
       }
        
        const target = event.target;
        let label;
       
        // Map input ID to label name
        switch (target.id) {
            case "source-switch":
                label = "Power_Source";
                break;
            case "entire-switch":
                label = "Entire_Board"
                break;
            case  "main-switch" :
                label = "Main_Circuit"
                break;
            case "sub-switch":
                label = "Sub_Circuit";
                break;
            case "seal_reset":
                label = "reset_seal";
                break;
        }

        // Update JSON
        if (label) {
            switchStates[label] = target.checked;
            console.log(switchStates); // Optional: Log to console
            const requestOptions_switch = {
  method: "POST",
  headers: myHeaders,
  body: JSON.stringify(switchStates),
  redirect: "follow"
};

fetch("https://iot-board.onrender.com/Data/switch", requestOptions_switch)
  .then((response) => response.text())
  .then((result) => console.log(result))
  .catch((error) => console.error(error));
        }
    }

    // Add listeners after page load
    window.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll('input[type="checkbox"]').forEach(input => {
            input.addEventListener("change", handleSwitchChange);
        });
    });



//-------------------------------------------------------------------------------------


        const myHeaders = new Headers();
        myHeaders.append("Content-Type", "application/json");
        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            initializeMap();
            initializeCharts();
            setupSwitches();
            // Auto-update every 2 seconds with simulated sensor data.
            setInterval(function() {
                const requestOptions = {
  method: "GET",
  headers: myHeaders,
  redirect: "follow"
};
//ip:192.168.140.6
fetch("https://iot-board.onrender.com/Data/get", requestOptions)
  .then((response) => response.json())
  .then((result) => {
    console.log("OK i reach here");
    trip_state = result.switch.trip;
    if(trip_state) {
        console.log("Trip Data Is seted");
    }
    updateSensorData(result)});
              
            }, 1500);
        });
        
        // Initialize the map with a marker for the distribution board location
        function initializeMap() {
            const map = L.map('map').setView([28.6139, 77.2090], 15);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);
            L.marker([28.6139, 77.2090]).addTo(map)
                .bindPopup('Distribution Board Location')
                .openPopup();
        }
        
        // Initialize charts with empty data; these will be updated later via updateSensorData
        function initializeCharts() {
            createLineChart('power-chart', [[], []], [], ['Main Circuit', 'Sub Circuit'], ['#3498db', '#2ecc71'], 'Power (W)');
            createLineChart('current-chart', [[], []], [], ['Main Circuit', 'Sub Circuit'], ['#3498db', '#2ecc71'], 'Current (A)');
            createLineChart('pf-chart', [[], []], [], ['Main Circuit', 'Sub Circuit'], ['#3498db', '#2ecc71'], 'Power Factor');
            createBarChart('energy-chart', [], 'date', ['main', 'sub', 'solar'], ['#3498db', '#2ecc71', '#f39c12'], 'Energy (kWh)');
        }
        
        // The update function receives a sensorData object and updates sensor text and graphs
        function updateSensorData(sensorData) {
            // Update Main Circuit values
            //console.log(sensorData);
    
            document.getElementById('main-voltage').textContent = sensorData.Main_Circuit.voltage.at(-1);
            document.getElementById('main-current').textContent = sensorData.Main_Circuit.current.at(-1);
            document.getElementById('main-power').textContent = sensorData.Main_Circuit.power.at(-1);
            document.getElementById('main-energy').textContent = sensorData.Main_Circuit.KWH;
            console.log("energy : ",sensorData.Main_Circuit.KWH);
            document.getElementById('main-pf').textContent = sensorData.Main_Circuit.PF.at(-1);
            document.getElementById('main-freq').textContent = sensorData.Main_Circuit.frequncy.at(-1);
            
          // update solar

            document.getElementById('solar-voltage').textContent = sensorData.Solar_Circuit.voltage.at(-1);
            document.getElementById('solar-current').textContent = sensorData.Solar_Circuit.current.at(-1);
            document.getElementById('solar-power').textContent = sensorData.Solar_Circuit.power.at(-1);
            document.getElementById('solar-energy').textContent = sensorData.Solar_Circuit.KWH;
            document.getElementById('solar-pf').textContent = sensorData.Solar_Circuit.PF.at(-1);
            document.getElementById('solar-freq').textContent = sensorData.Solar_Circuit.frequncy.at(-1);

            // Update Sub Circuit values
            document.getElementById('sub-voltage').textContent = sensorData.Sub_Circuit.voltage.at(-1);
            document.getElementById('sub-current').textContent = sensorData.Sub_Circuit.current.at(-1);
            document.getElementById('sub-power').textContent = sensorData.Sub_Circuit.power.at(-1);
            document.getElementById('sub-energy').textContent = sensorData.Sub_Circuit.KWH;
            document.getElementById('sub-pf').textContent = sensorData.Sub_Circuit.PF.at(-1);
            document.getElementById('sub-freq').textContent = sensorData.Sub_Circuit.frequncy.at(-1);
            
            // Update phase values
            document.getElementById('phase-voltage').textContent = sensorData.Master_Circuit.voltage.at(-1);
            document.getElementById('phase-current').textContent = sensorData.Master_Circuit.current.at(-1);
            document.getElementById('phase-power').textContent = sensorData.Master_Circuit.power.at(-1);
            document.getElementById('phase-energy').textContent = sensorData.Master_Circuit.KWH;
            document.getElementById('phase-pf').textContent = sensorData.Master_Circuit.PF.at(-1);
            document.getElementById('phase-freq').textContent = sensorData.Master_Circuit.frequncy.at(-1);
            
            if(sensorData.seal) {
            document.querySelector("#seal-status").classList.remove("seal-intact");
            document.querySelector("#seal-status").classList.add("seal-tampered");
            }
            else {
                document.querySelector("#seal-status").classList.remove("seal-tampered");
                document.querySelector("#seal-status").classList.add("seal-intact");
            }

            // Update charts with the provided graph data
            createLineChart('power-chart',[sensorData.Master_Circuit.power,sensorData.Sub_Circuit.power],sensorData.timestep, ['Main Circuit', 'Sub Circuit'], ['#3498db', '#2ecc71'], 'Power (W)');
            createLineChart('current-chart', [sensorData.Master_Circuit.current, sensorData.Sub_Circuit.current], sensorData.timestep, ['Main Circuit', 'Sub Circuit'], ['#3498db', '#2ecc71'], 'Current (A)');
            createLineChart('pf-chart', [sensorData.Master_Circuit.PF, sensorData.Sub_Circuit.PF], sensorData.timestep, ['Main Circuit', 'Sub Circuit'], ['#3498db', '#2ecc71'], 'Power Factor');
           
            createBarChart(
  'energy-chart',
  [{
    date: 'Today', // or any other appropriate date if you have one
    main: sensorData.Main_Circuit.KWH,
    sub: sensorData.Sub_Circuit.KWH,
    solar: sensorData.Solar_Circuit.KWH
  }],
  'date', // The key in the object to map for X axis (in this case, 'date')
  ['main', 'sub', 'solar'], // The keys to map to Y axis (your KWH values)
  ['#3498db', '#2ecc71', '#f39c12'], // The colors for the bars
  'Energy (kWh)' // Label for the Y-axis
);

        }
        
        // Simulate sensor data for demonstration purposes
        function simulateSensorData() {
            const sensorData = {
                // Sensor readings with slight random fluctuations
                mainVoltage: (230 + (Math.random() * 4 - 2)).toFixed(2),
                mainCurrent: (15 + (Math.random() * 3 - 1.5)).toFixed(2),
                mainPower: (3500 + (Math.random() * 600 - 300)).toFixed(2),
                mainEnergy: (24.8 + (Math.random() * 0.2 - 0.1)).toFixed(2),
                mainPF: (0.98 + (Math.random() * 0.06 - 0.03)).toFixed(2),
                mainFreq: (50 + (Math.random() * 0.2 - 0.1)).toFixed(2),
                
                subVoltage: (229 + (Math.random() * 4 - 2)).toFixed(2),
                subCurrent: (8.5 + (Math.random() * 2 - 1)).toFixed(2),
                subPower: (2000 + (Math.random() * 400 - 200)).toFixed(2),
                subEnergy: (12.3 + (Math.random() * 0.2 - 0.1)).toFixed(2),
                subPF: (0.95 + (Math.random() * 0.08 - 0.04)).toFixed(2),
                subFreq: (50 + (Math.random() * 0.2 - 0.1)).toFixed(2),
                
                solarVoltage: (245 + (Math.random() * 10 - 5)).toFixed(2),
                solarCurrent: (12 + (Math.random() * 6 - 3)).toFixed(2),
                solarPower: (3000 + (Math.random() * 1000 - 500)).toFixed(2),
                solarEnergy: (18.7 + (Math.random() * 1 - 0.5)).toFixed(2),
                solarPF: (1.0 + (Math.random() * 0.04 - 0.02)).toFixed(2),
                solarFreq: (50 + (Math.random() * 0.2 - 0.1)).toFixed(2),
                
                // Graph data arrays
                timestamps: Array.from({length: 24}, (_, i) => `${i}:00`),
                mainPowerGraph: Array.from({length: 24}, () => 3500 + (Math.random() * 600 - 300)),
                subPowerGraph: Array.from({length: 24}, () => 2000 + (Math.random() * 400 - 200)),
                mainCurrentGraph: Array.from({length: 24}, () => 15 + (Math.random() * 3 - 1.5)),
                subCurrentGraph: Array.from({length: 24}, () => 8.5 + (Math.random() * 2 - 1)),
                mainPFGraph: Array.from({length: 24}, () => 0.98 + (Math.random() * 0.06 - 0.03)),
                subPFGraph: Array.from({length: 24}, () => 0.95 + (Math.random() * 0.08 - 0.04)),
                
                // Daily energy consumption for the past 30 days
                dailyEnergy: Array.from({length: 30}, (_, i) => {
                    const date = new Date();
                    date.setDate(date.getDate() - (29 - i));
                    return {
                        date: date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }),
                        main: (20 + Math.random() * 10).toFixed(2),
                        sub: (10 + Math.random() * 6).toFixed(2),
                        solar: (15 + Math.random() * 8).toFixed(2)
                    };
                })
            };
            console.log(sensorData)
            return sensorData;
        }
        
        // D3 chart functions
        function createLineChart(containerId, data, labels, seriesNames, colors, yLabel) {
            const margin = {top: 20, right: 30, bottom: 40, left: 50};
            const container = document.getElementById(containerId);
            const width = container.clientWidth - margin.left - margin.right;
            const height = 250 - margin.top - margin.bottom;
        
            // Clear previous chart
            d3.select(`#${containerId}`).html("");
            
            const svg = d3.select(`#${containerId}`)
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);
        
            // Create scales
            const x = d3.scalePoint()
                .domain(labels)
                .range([0, width]);
            
            const y = d3.scaleLinear()
                .domain([0, d3.max(data.flat(), d => +d) * 1.1])
                .range([height, 0]);
            
            // Add axes
            svg.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x))
                .selectAll("text")
                .style("text-anchor", "end")
                .attr("dx", "-.8em")
                .attr("dy", ".15em")
                .attr("transform", "rotate(-45)");
            
            svg.append("g")
                .call(d3.axisLeft(y));
            
            // Y axis label
            svg.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 0 - margin.left)
                .attr("x", 0 - (height / 2))
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .text(yLabel);
            
            // Line generator
            const line = d3.line()
                .x((d, i) => x(labels[i]))
                .y(d => y(d));
            
            // Draw each series
            data.forEach((series, i) => {
                svg.append("path")
                    .datum(series)
                    .attr("fill", "none")
                    .attr("stroke", colors[i])
                    .attr("stroke-width", 2)
                    .attr("d", line);
                
                // Draw data points
                svg.selectAll(`.dot-${i}`)
                    .data(series)
                    .enter().append("circle")
                    .attr("class", `dot-${i}`)
                    .attr("cx", (d, idx) => x(labels[idx]))
                    .attr("cy", d => y(d))
                    .attr("r", 3)
                    .attr("fill", colors[i]);
            });
            
            // Legend
            const legend = svg.append("g")
                .attr("transform", `translate(${width - 100}, 0)`);
            
            seriesNames.forEach((name, i) => {
                const legendItem = legend.append("g")
                    .attr("transform", `translate(0, ${i * 20})`);
                
                legendItem.append("rect")
                    .attr("width", 15)
                    .attr("height", 15)
                    .attr("fill", colors[i]);
                
                legendItem.append("text")
                    .attr("x", 20)
                    .attr("y", 9)
                    .attr("dy", ".35em")
                    .style("font-size", "12px")
                    .text(name);
            });
        }
        
        function createBarChart(containerId, data, xKey, yKeys, colors, yLabel) {
            const margin = {top: 20, right: 30, bottom: 40, left: 50};
            const container = document.getElementById(containerId);
            const width = container.clientWidth - margin.left - margin.right;
            const height = 250 - margin.top - margin.bottom;
        
            // Clear previous chart
            d3.select(`#${containerId}`).html("");
            
            const svg = d3.select(`#${containerId}`)
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);
        
            // X scale
            const x = d3.scaleBand()
                .domain(data.map(d => d[xKey]))
                .range([0, width])
                .padding(0.2);
            
            // Y scale
            const y = d3.scaleLinear()
                .domain([0, d3.max(data, d => Math.max(...yKeys.map(key => d[key]))) * 1.1])
                .range([height, 0]);
            
            // Axes
            svg.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x))
                .selectAll("text")
                .style("text-anchor", "end")
                .attr("dx", "-.8em")
                .attr("dy", ".15em")
                .attr("transform", "rotate(-45)");
            
            svg.append("g")
                .call(d3.axisLeft(y));
            
            // Y axis label
            svg.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 0 - margin.left)
                .attr("x", 0 - (height / 2))
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .text(yLabel);
            
            // Draw bars for each key (side-by-side)
            const barGroups = svg.selectAll(".bar-group")
                .data(data)
                .enter()
                .append("g")
                .attr("class", "bar-group")
                .attr("transform", d => `translate(${x(d[xKey])}, 0)`);
            
            const barWidth = x.bandwidth() / yKeys.length;
            yKeys.forEach((key, i) => {
                barGroups.append("rect")
                    .attr("x", i * barWidth)
                    .attr("y", d => y(d[key]))
                    .attr("width", barWidth)
                    .attr("height", d => height - y(d[key]))
                    .attr("fill", colors[i]);
            });
            
            // Legend
            const legend = svg.append("g")
                .attr("transform", `translate(${width - 100}, 0)`);
            
            yKeys.forEach((key, i) => {
                const legendItem = legend.append("g")
                    .attr("transform", `translate(0, ${i * 20})`);
                
                legendItem.append("rect")
                    .attr("width", 15)
                    .attr("height", 15)
                    .attr("fill", colors[i]);
                
                legendItem.append("text")
                    .attr("x", 20)
                    .attr("y", 9)
                    .attr("dy", ".35em")
                    .style("font-size", "12px")
                    .text(key);
            });
        }
        
        // Setup control switches (example for source switch)
        function setupSwitches() {
            document.getElementById('source-switch').addEventListener('change', function() {
                const currentSource = document.getElementById('current-source');
                if (this.checked) {
                    currentSource.textContent = "Solar";
                    currentSource.classList.remove('status-active');
                    currentSource.classList.add('status-warning');
                } else {
                    currentSource.textContent = "Main Phase";
                    currentSource.classList.remove('status-warning');
                    currentSource.classList.add('status-active');
                }
            });
            
            // Example event listeners for other switches
            document.getElementById('main-switch').addEventListener('change', function() {
                console.log(`Main circuit ${this.checked ? 'ON' : 'OFF'}`);
            });
            
            document.getElementById('sub-switch').addEventListener('change', function() {
                console.log(`Sub circuit ${this.checked ? 'ON' : 'OFF'}`);
            });
        }
        </script>
        
            
</body>
</html>